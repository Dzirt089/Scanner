<Window x:Class="Scanner.WPF.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Scanner.WPF"
        mc:Ignorable="d"
        Title="Сканнер" Height="450" Width="1000"
        Icon="/Icons/Scanner-3.ico">
    <Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="*"/>
			<RowDefinition Height="Auto"/>
		</Grid.RowDefinitions>
		
		<ListView Grid.Row="0" 
            ItemsSource="{Binding LastScans, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}">
			<ListView.View>
				<GridView>
					<GridViewColumn Header="№ Заказа" Width="70"
                                    DisplayMemberBinding="{Binding ZakNm}"/>
					<GridViewColumn Header="Артикул" Width="180"
                                    DisplayMemberBinding="{Binding Art}"/>
					<GridViewColumn Header="Наименование" Width="300"
                                    DisplayMemberBinding="{Binding Name}"/>
					<GridViewColumn Header="Система" Width="50"
									DisplayMemberBinding="{Binding NameVkc}"/>
					<GridViewColumn Header="План" Width="70"
									DisplayMemberBinding="{Binding Planed, StringFormat=dd.MM.yyyy}"/>
					<GridViewColumn Header="Время скана" Width="100"
									DisplayMemberBinding="{Binding ScanerTime, StringFormat=dd.MM.yyyy HH.mm}"/>
					<GridViewColumn Header="Отделение" Width="150"
									DisplayMemberBinding="{Binding Department}"/>
				</GridView>
			</ListView.View>
		</ListView>

		<!-- Панель с кнопкой -->
		<StackPanel Grid.Row="1" Orientation="Horizontal" Margin="5">
			<Button Content="Последние активные сканеры" Command="{Binding RefreshScansCommand}" Padding="10,5"/>
		</StackPanel>

		<!-- Всплывающее окно -->
		<Popup x:Name="ScannersPopup" 
           Placement="Center" 
           StaysOpen="False"
           IsOpen="{Binding IsPopupOpen, Mode=TwoWay}"
           Width="400" Height="300">
			<Border Background="White" BorderBrush="Gray" BorderThickness="1" 
                CornerRadius="5" Padding="10">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="*"/>
						<RowDefinition Height="Auto"/>
					</Grid.RowDefinitions>

					<TextBlock Grid.Row="0" Text="Активные сканеры" 
                           FontWeight="Bold" FontSize="14" Margin="0,0,0,10"/>

					<ListView Grid.Row="1" ItemsSource="{Binding Scans}">
						<ListView.View>
							<GridView>
								<GridViewColumn Header="Имя" Width="120" 
                                            DisplayMemberBinding="{Binding Name}"/>
								<GridViewColumn Header="Активен" Width="60">
									<GridViewColumn.CellTemplate>
										<DataTemplate>
											<CheckBox IsChecked="{Binding IsActive}" 
                                                  IsEnabled="False"/>
										</DataTemplate>
									</GridViewColumn.CellTemplate>
								</GridViewColumn>
								<GridViewColumn Header="Последнее обновление" Width="140"
                                            DisplayMemberBinding="{Binding LastReceived, StringFormat=dd.MM.yyyy HH:mm}"/>
							</GridView>
						</ListView.View>
					</ListView>

					<Button Grid.Row="2" Content="Закрыть" HorizontalAlignment="Right" 
                        Margin="0,10,0,0" Padding="10,3"
                        Command="{Binding ClosePopupCommand}"/>
				</Grid>
			</Border>
		</Popup>
	</Grid>
</Window>
